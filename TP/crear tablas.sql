CREATE TABLE H_CARGO_RESERVA
(
    CODIGO_CARGO              NUMBER(10) GENERATED BY DEFAULT AS IDENTITY 
    (START WITH 1 MINVALUE 1 MAXVALUE 9999999999 INCREMENT BY 1)
    NOT NULL CONSTRAINT  PK_COD_CARGO PRIMARY KEY,
    CODIGO_RESERVA            NUMBER(12) NOT NULL,
    ID_PROD_SERV              NUMBER(5) NOT NULL,
    PRECIO_UNITARIO           NUMBER(10) NOT NULL,
    CANTIDAD                  NUMBER(5) NOT NULL,
    APLICAR_COBRO             VARCHAR2(1) DEFAULT 'S' NOT NULL 
    CHECK (APLICAR_COBRO IN ('S', 'N')),
    CODIGO_FACTURA            NUMBER(15),
CONSTRAINT FK_COD_RESERVA FOREIGN KEY(CODIGO_RESERVA)
REFERENCES H_RESERVA(CODIGO),
CONSTRAINT FK_ID_PROD_SERV FOREIGN KEY(ID_PROD_SERV)
REFERENCES H_PRODUCTO_SERVICIO(ID),
CONSTRAINT FK_COD_FACTURA FOREIGN KEY(CODIGO_FACTURA)
REFERENCES H_FACTURA_VENTA(CODIGO)
);


-- DROP COLUMNS, MODIFY FK
CREATE TABLE H_DETALLE_PAGO
(
    CODIGO              NUMBER(15) NOT NULL,
    NUM_ITEM                 NUMBER(5) NOT NULL,
    MONTO                    NUMBER(15) NOT NULL, 
	COD_METODO 				 NUMBER(5) NOT NULL,
CONSTRAINT PK_DETALLE_ITEM PRIMARY KEY (CODIGO, NUM_ITEM),
CONSTRAINT FK_COD_METODO FOREIGN KEY(COD_METODO)
REFERENCES H_METODO_PAGO(CODIGO)
);

CREATE TABLE H_FACTURA_VENTA
(
    CODIGO                      NUMBER(15) NOT NULL CONSTRAINT PK_COD PRIMARY KEY,
    FECHA_EMISION           	DATE NOT NULL,
	FECHA_CARGA					DATE NOT NULL,
	NUMERO_FACTURA				VARCHAR2(20) NOT NULL,
	NUMERO_TIMBRADO				NUMBER(15) NOT NULL,
	MONTO_GRAVADO				NUMBER(15) NOT NULL,
	MONTO_IVA					NUMBER(15) NOT NULL,
	MONTO_EXENTO				NUMBER(15) NOT NULL,
	CODIGO_RESERVA				NUMBER(12) NOT NULL,
CONSTRAINT FK_NUM_TIMBRADO FOREIGN KEY(NUMERO_TIMBRADO)
REFERENCES H_TIMBRADO(NUMERO_TIMBRADO),
CONSTRAINT FK_COD_RESERVA FOREIGN KEY(CODIGO_RESERVA)
REFERENCES H_RESERVA(CODIGO)
);

CREATE TABLE H_OCUPANTE
(
    CODIGO_OCUPANTE             NUMBER(10) NOT NULL,
    CODIGO_RESERVA          	NUMBER(12) NOT NULL,
	FEC_HORA_ENTRADA 			DATE NOT NULL,
	FEC_HORA_SALIDA 			DATE CONSTRAINT CK_FEC_HORA_SALIDA CHECK (
	FEC_HORA_SALIDA IS NULL OR FEC_HORA_SALIDA > FEC_HORA_ENTRADA
	),
CONSTRAINT PK_OCUPANTE_RESERVA PRIMARY KEY (CODIGO_OCUPANTE, CODIGO_RESERVA),
CONSTRAINT FK_COD_OCUPANTE FOREIGN KEY(CODIGO_OCUPANTE)
REFERENCES H_HUESPED(CODIGO),
CONSTRAINT FK_COD_RESERVA FOREIGN KEY(CODIGO_RESERVA)
REFERENCES H_RESERVA(CODIGO)
);

CREATE TABLE H_RESERVA
(
    CODIGO		              NUMBER(12) GENERATED ALWAYS AS IDENTITY 
    (START WITH 1 MINVALUE 1 MAXVALUE 9999999999 INCREMENT BY 1)
    NOT NULL CONSTRAINT  PK_COD PRIMARY KEY,
    FECHA_RESERVA             DATE NOT NULL,
    MONTO_TOTAL               NUMBER(10) NOT NULL,
    HUESPED_TITULAR           NUMBER(10) NOT NULL,
    SALDO_ABONAR              NUMBER(10) NOT NULL,
    CHECK_IN	              DATE NOT NULL,
	CHECK_OUT	              DATE NOT NULL,
    NUM_HABITACION            NUMBER(5) NOT NULL,
	ESTADO					  VARCHAR2(1) DEFAULT 'P' NOT NULL 
	CHECK (ESTADO IN ('P', 'C', 'X', 'F')),
	CODIGO_CANAL			  NUMBER(5) NOT NULL,
CONSTRAINT CK_INOUT CHECK (CHECK_OUT >= CHECK_IN),
CONSTRAINT FK_H_TITULAR  FOREIGN KEY(HUESPED_TITULAR)
REFERENCES H_HUESPED(CODIGO),
CONSTRAINT FK_N_HABITACION FOREIGN KEY(NUM_HABITACION)
REFERENCES H_HABITACION(NUMERO),
CONSTRAINT FK_COD_CANAL FOREIGN KEY(CODIGO_CANAL)
REFERENCES H_CANAL_RESERVA(CODIGO)
);






ALTER TABLE H_METODO_PAGO
ADD ESTADO VARCHAR2(1) DEFAULT 'A';



ALTER TABLE H_METODO_PAGO
ADD DESCRIPCION VARCHAR2(255);
-- Un campo adicional que permita describir con más detalle el método de pago
-- podría ser útil, por ejemplo, para diferenciar entre distintos tipos de
--  tarjetas (Visa, MasterCard) o bancos emisores.

DROP TABLE h_emisor_tarjeta CASCADE CONSTRAINTS;